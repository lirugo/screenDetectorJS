<html>
    <head>
        <style>
            html, body {
                margin: 0;
            }
            body {
                height: 100%;
            }
            
            .container {
                height: 100vh;
                display: grid;
                grid-template-columns: auto;
            }

            @media only screen and (min-width: 1020px) {
                .container {
                    display: grid;
                    grid-template-columns: 50% auto;
                    grid-template-rows: 100%;
                    grid-template-areas:
                        "leftSide rightSide";
                    height: 100vh;
                }

                .leftSide {
                    grid-area: leftSide;
                }
                .rightSide {
                    grid-area: rightSide;
                }
            }

            .container section {
                padding: 2em;
            }

            .container section h1 {
                text-align: center;
                font-weight: normal;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <section class="leftSide">
                <h1>Image from canvas</h1>
                <canvas id="canvas" width="300" height="300"></canvas>
            </section>
            <section class="rightSide">
                <h1>Image from &lt;video&gt; WebRTC</h1>
                <video id="localVideo" playsinline autoplay muted></video>
            </section>
        </div>


        <script src="https://webrtc.github.io/adapter/adapter-latest.js"></script>
        <script>
            'use strict';

            const FPS = 10;
            let width, height;

            const localVideo = document.getElementById('localVideo');
            const canvas = document.getElementById("canvas");

            localVideo.addEventListener('loadedmetadata', function() {
                width = this.videoWidth;
                height = this.videoHeight;
                console.log(`Local video videoWidth: ${this.videoWidth}px, videoHeight: ${this.videoHeight}px`);
            });

            function drawOnCanvasFromVideoStream(){
                let ctx = canvas.getContext("2d");
                ctx.drawImage(localVideo, 0, 0, width, height, 0, 0, width, height);
                
                //Draw test line on canvas
                ctx.beginPath();       
                ctx.moveTo(0, 0);    
                ctx.lineTo(width, height);  
                ctx.lineWidth = 10;
                ctx.strokeStyle = '#ff0000'
                ctx.stroke();
                        
                let img = canvas.toDataURL("image/jpg");
            }

            async function startVideoStreamWebRTC() {
                console.log('Requesting local stream');
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({audio: false, video: true});
                    console.log('Received local stream');
                    localVideo.srcObject = stream;
                } catch (e) {
                    alert(`getUserMedia() error: ${e.name}`);
                }                   
            }

            startVideoStreamWebRTC();
            //Update canvas every time in interval
            setInterval(function(){
                drawOnCanvasFromVideoStream();
            }, 1000/FPS);
        </script>
    </body>
</html>
